import express, { Router } from "express";
import BodyParser from "body-parser";

import { getAllMenu, saveMenu, updateMenu, deleteMenu, getSingledMenu, getAllDrinks, saveDrinks, updateDrinks, deleteDrinks, getSingleDrinks, getAllUser, saveUser, updateUser, deleteUser, getSingleUser, createAdmin, adminUserExists, isLoginCorrect, getAllSchedule} from "../data/database.js";
import fileUpload from 'express-fileupload';
const router = express.Router();
const app = express();

app.use(BodyParser.urlencoded({ extended: true }));

app.use(
    fileUpload({
        limits:{
            fileSize: 2 * 1024 * 1024
        },
        abortOnLimit: true,
    })
);

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////   ============ All of Menu ==============   //////////////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//Create Menu
router.get("/create-menu-item", async (req, res) => {
	res.render("admin_pages/create-menu-item", { title: "Create Menu Item" });
});

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// Update Menu
router.get("/update-menu-item/:id", async (req, res) => {
	const mealItem = await getSingledMenu(req.params.id);
	res.render("admin_pages/update-meal-item", {
		title: "Update Menu",
		mealItem,
	});
});
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//Delete Menu
router.get("/delete-menu-item/:id", async (req, res) => {
	const mealItem = await getSingledMenu(req.params.id);

	res.render("admin_pages/delete-menu-item", {
		title: "Delete Menu Item",
		mealItem,
	});
});
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////   ============ All of Drinks ==============   //////////////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//Create Drink
router.get("/create-drink-item", async (req, res) => {
	res.render("admin_pages/drink-item", { title: "Create Drink Item" });
});
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// Update Drinks
router.get("/update-drink", async (req, res) => {
	res.render("admin_pages/drink-update", { title: "Update Drink" });

});
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//Delete Drink
router.get("/delete-drink-item/:id", async (req, res) => {
    const drinkItem = await getSingleDrinks(req.params.id);
    res.render("admin_pages/delete-drink-item", {
        title: "Confirm Deletion",
        drinkItem
    });
});
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


///////////////////////////////////////////   ============ All of Schedule ==============   //////////////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// Create Meal Schedule
router.get("/create-meal-schedule", async (req, res) => {
	res.render("admin_pages/meal-schedule", { title: "Create meal schedule" });
});
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////








//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////   ============== DATABASE ACTIONS ==============   ///////////////////////////////////////////////////////////////////////////////////////////////////////////

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////







//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////   ============ Post For  MENU ==============   //////////////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// Create Menu Post

router.post('/create-menu-item', async (req, res) => {
    const menuItemData = {
        item_name: req.body.item_name,
        quantity: req.body.quantity,
        description: req.body.description,
        img: req.files ? `${getRandomHexValues(8)}_${req.files.image.name}` : ''
    };

    if (req.files) {
        req.files.image.mv('./uploads/' + menuItemData.img);
    }

    console.log(menuItemData);
    await saveMenu(menuItemData);
    res.redirect('/');
});

router.get('/create-menu-item', async (req, res) => {
    res.render('admin_pages/create-menu-item', { title: 'Create Menu Item' });
});

id, beverage, quantity, img, description

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//Update Menu Post

router.post('/update-menu', async (req, res) => {
    const menuItemData = {
        id: req.body.id,
        item_name: req.body.item_name,
        quantity: req.body.quantity,
        description: req.body.description,
    };

    menuItemData.img = req.files ? `${getRandomHexValues(8)}_${req.files.image.name}` : '';

    if (req.files) {
        req.files.image.mv('./uploads/' + menuItemData.img);
    }

    console.log(menuItemData);
    await updateMenu(menuItemData);
    res.redirect('/menu');
});

router.get('/update-menu', async (req, res) => {
    res.render('admin_pages/menu-update', { title: 'Update Menu' });
});

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//Delete Menu Post

router.post('/delete-menu-item', async (req, res) => {
    const menuItemId = req.body.id;

    console.log("Deleting menu item with ID:", menuItemId);
    await deleteMenu(menuItemId);
    res.redirect('/');
});
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// Get a Single Menu Post 

router.post('/get-single-menu-item', async (req, res) => {
    const menuId = req.body.id;

    console.log("getting the menu", menuId);
    const menuItem = await getSingledMenu(menuId);
    console.log("getting  menu item:", menuItem);
    res.redirect('/');
});
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////   ============== Post For  Drinks ==============   //////////////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// Create Drinks Post

router.post('/create-drink-item', async (req, res) => {
    const drinkItemData = {
        id: req.body.id,
        beverage: req.body.beverage,
        quantity: req.body.quantity,
        description: req.body.description,
        img: req.files ? `${getRandomHexValues(8)}_${req.files.image.name}` : ''
       
    };

    if (req.files) {
        req.files.image.mv('./uploads/' + drinkItemData.img);
    }

    console.log(drinkItemData);
    await saveDrinks(drinkItemData);
    res.redirect('/');
});
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// Update Drink Post
router.post('/update-drink-item', async (req, res) => {
    const drinkItemData = {
        id: req.body.id,
        beverage: req.body.beverage,
        quantity: req.body.quantity,
        description: req.body.description,
        img: req.files ? `${getRandomHexValues(8)}_${req.files.image.name}` : ''
    };

    if (req.files) {
        req.files.image.mv('./uploads/' + drinkItemData.img);
    }

    console.log(drinkItemData);
    await updateDrinks(drinkItemData);
    res.redirect('/');
});
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//Delete Drinks Post

router.post('/delete-drink-item', async (req, res) => {
    const menuItemId = req.body.id;

    console.log("Deleting drink item with ID:", menuItemId);
    await deleteDrinks(menuItemId);
    res.redirect('/');
});
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// Get a Single drink Post 

router.post('/get-single-drink-item', async (req, res) => {
    const menuId = req.body.id;

    console.log("getting the drink", menuId);
    const menuItem = await getSingleDrinks(menuId);
    console.log("getting  menu item:", menuItem);
    res.redirect('/');
});
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////   ============== Post For  Schedule ==============   //////////////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//Create Meal Schedule

router.post('/create-mealschedule', async (req, res) => {
    const menuItemData = {
        item_name: req.body.item_name,
        quantity: req.body.quantity,
        description: req.body.description,
        img: req.body.img
    }

    console.log(menuItemData);
    await saveMenu(menuItemData);
    res.redirect('/');
});
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



//! DO NOT CREATE ANY ROUTES BELOW THIS EXPORT
export const adminRoute = router;
